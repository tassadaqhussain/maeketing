!function(t,e,o){"use strict";function i(){var t=o("#product-type").val();o(".woocommerce_tm_epo").toArray().forEach(function(e){var i=o(e),c=i.find(".tmcp_attribute").val(),a=i.find("select.tmcp_att").val(),n=i.find("select.tmcp-variation").val(),r="input.tmcp-price-input-variation-"+n+"[data-price-input-attribute='"+a+"'],select.tmcp-price-input-variation-"+n+"[data-price-input-attribute='"+a+"']";"variable"!==t&&"variable-subscription"!==t?i.find(".show_if_variable").hide():i.find(".show_if_variable").show(),i.find("select.tmcp_att").hide(),i.find("select.tmcp_att[data-tm-attr='"+c+"']").show(),i.find("input.tmcp-price-input").hide(),i.find("select.tmcp-price-input-type").hide(),i.find(r).show()})}function c(){o(".woocommerce_tm_epos .woocommerce_tm_epo").toArray().forEach(function(t){o(".tm_epo_menu_order",t).val(parseInt(o(t).index(".woocommerce_tm_epos .woocommerce_tm_epo"),10))})}function a(t,e){var o,i=t.val(),c=t.closest(".woocommerce_tm_epo"),a=c.find("input.tmcp_loop").val(),n=c.find("select.tmcp_att").val(),r=c.find("select.tmcp-variation").val(),p="";switch(c.find("input.tmcp-price-input").hide(),c.find("select.tmcp-price-input-type").hide(),e){case"variation":r=i,p="input.tmcp-price-input-variation-"+i+"[data-price-input-attribute='"+n+"'],select.tmcp-price-input-variation-"+i+"[data-price-input-attribute='"+n+"']";break;case"attribute":n=i,p="input.tmcp-price-input-variation-"+r+"[data-price-input-attribute='"+i+"'],select.tmcp-price-input-variation-"+r+"[data-price-input-attribute='"+i+"']"}c.find(p).length<=0&&((o=c.find(".tmcp_pricing")).append('<input type="text" size="5" name="tmcp_regular_price['+a+"]["+n+"]["+r+']" value="" class="wc_input_price tmcp-price-input tmcp-price-input-variation-'+r+'" data-price-input-attribute="'+n+'" />'),o.append('<select class="tmcp-price-input-type tmcp-price-input tmcp-price-input-variation-'+r+'" data-price-input-attribute="'+n+'" name="tmcp_regular_price_type['+a+"]["+n+"]["+r+']"><option value="">'+_.i18n_fixed_type+'</option><option value="percent">'+_.i18n_percent_type+"</option></select>")),c.find(p).show()}function n(){var t;1===m&&(o("#tm_extra_product_options").block({message:null,overlayCSS:{background:"#fff url("+_.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}}),t={action:"woocommerce_tm_load_epos",post_id:_.post_id,security:_.load_tm_epo_nonce},o.post(_.ajax_url,t,function(t){o(".tm_mode_local").html(t),o("#tm_extra_product_options").unblock(),o("#tm_extra_product_options").trigger("woocommerce_tm_epos_loaded"),m=0,i()}))}function r(t){t&&(o("#tm_meta_cpf_mode").val(t),o(".tm_mode_selector").addClass("tm_hidden"),o(".tm_mode_builder,.tm_mode_local,.tm_mode_settings").hide(),o(".tm_mode_"+t).show(),o(".tm_builder_select,.tm_local_select,.tm_settings_select").removeClass("button-primary"),o(".tm_"+t+"_select").addClass("button-primary"))}var p,_=t.TMEPOADMINJS,m=0;_&&o(e).ready(function(){p={items:".woocommerce_tm_epo",cursor:"move",axis:"y",handle:"h3 .move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){t&&e.item.css("background-color","#f6f6f6")},stop:function(t,e){t&&e.item.removeAttr("style"),c()}},i(),o("#tm_extra_product_options").on("change","select.tmcp-variation",function(){a(o(this),"variation")}),o("#tm_extra_product_options").on("change","select.tmcp_att",function(){a(o(this),"attribute")}),o("#tm_extra_product_options").on("woocommerce_tm_epo_added",function(){o(".woocommerce_tm_epos").sortable(p)}),o("#tm_extra_product_options").on("woocommerce_tm_epos_loaded",function(){o(".woocommerce_tm_epos").sortable(p)}),o(".woocommerce_tm_epos").sortable(p),o("#variable_product_options").on("click","button.remove_variation",function(){m=1}),o("#variable_product_options").on("woocommerce_variations_added",function(){m=1}),o(".product_attributes").on("click","button.add_new_attribute",function(){m=1}),o(".save_attributes").on("click",function(){m=1}),o(".tm_epo_class a").on("click",function(){n()}),o("#tm_extra_product_options").on("click","button.tm_add_epo",function(){var e=o("select.tmcp_attr_list").val(),c=o(".woocommerce_tm_epos .woocommerce_tm_epo[data-epo-attr='"+e+"']"),a=o(".woocommerce_tm_epo").length,n={action:"woocommerce_tm_add_epo",post_id:_.post_id,att_id:e,loop:a,security:_.add_tm_epo_nonce};if(!(c.length>0))return o(".tm_mode_local").block({message:null,overlayCSS:{background:"#fff url("+_.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}}),o.post(_.ajax_url,n,function(e){"max"===e?(t.alert(_.i18n_max_tmcp),o(".tm_mode_local").unblock()):e&&(o(".woocommerce_tm_epos").append(e),o("#tm_extra_product_options").trigger("woocommerce_tm_epo_added"),i())}).always(function(){o(".tm_mode_local").unblock()}),!1;c.find(".woocommerce_tmcp_attributes").show()}),o("#tm_extra_product_options").on("click",".remove_tm_epo",function(e){var i,c,a,n=t.confirm(_.i18n_remove_tmcp);return e.preventDefault(),n&&(i=o(this).parent().parent(),(c=o(this).attr("rel"))>0?(i.block({message:null,overlayCSS:{background:"#fff url("+_.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}}),a={action:"woocommerce_tm_remove_epo",tmcpid:c,security:_.delete_tm_epo_nonce},o.post(_.ajax_url,a,function(){i.fadeOut("300",function(){i.remove()})})):i.fadeOut("300",function(){i.remove()})),!1}),o("#tm_extra_product_options").on("change",".tm-type",function(){var t=o(this),e=t.closest(".data").find(".tmcp_choices");"checkbox"===t.val()?e.removeClass("tm-hidden"):e.addClass("tm-hidden")}),o("#tm_extra_product_options").on("click",".tm_select_mode",function(t){var e="local";t.preventDefault(),o(this).is(".tm_builder_select")&&(e="builder"),o(this).is(".tm_settings_select")&&(e="settings"),r(e)}),o("#tm_meta_cpf_mode").val()||o("#tm_meta_cpf_mode").val("builder"),r(o("#tm_meta_cpf_mode").val()),o("#woocommerce-order-items").on("click.tc","a.tm-delete-order-item",function(t){var e,i,c=o(this).closest("tr.item, tr.fee, tr.shipping");t.preventDefault(),e=o("<input type='hidden' class='tm_meta_serialized' name='tm_item_id' />").val(c.attr("data-tm_item_id")),i=o("<input type='hidden' class='tm_meta_serialized' name='tm_key' />").val(c.attr("data-tm_key_id")),c.prepend(e).prepend(i),o(".button.calculate-action").trigger("click")})})}(window,document,window.jQuery);