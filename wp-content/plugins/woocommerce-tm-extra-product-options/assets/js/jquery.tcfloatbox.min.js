!function(t){"use strict";var e=function(e,i){return this.element=t(e),this.settings=t.extend({},t.fn.tcFloatBox.defaults,i),this.settings.type="<"+this.settings.type+">",this.top=0,this.left=0,this.ticking=!1,1===this.element.length&&(this.init(),this)};e.prototype={constructor:e,destroy:function(){var e=this.settings;return void 0!==this.instance&&(t.fn.tcFloatBox.instances.splice(this.instance,1),delete this.instance,e.hideelements&&t("embed, object, select").css({visibility:"visible"}),e._ovl&&(e._ovl.unbind(),e._ovl.remove(),delete e._ovl),t(e.floatboxID).remove(),this.element.removeData("tcfloatbox"),t(window).off("scroll.tcfloatbox"+this.instance),t(window).off("resize.tcfloatbox"+this.instance)),this},hide:function(){var e=this.settings;e.hideelements&&t("embed, object, select").css({visibility:"visible"}),!0===e.showoverlay&&e._ovl&&e._ovl.hide(),t(e.floatboxID).addClass("tc-closing").removeClass(e.animateIn).addClass(e.animateOut),t(e.floatboxID).animate({opacity:0},e.closefadeouttime,function(){t(e.floatboxID).hide(),t(e.floatboxID).removeClass("tc-closing").addClass("tc-closed")}),t(window).off("scroll.tcfloatbox"+this.instance),t(window).off("resize.tcfloatbox"+this.instance)},requestTick:function(){var t=this.settings;this.ticking||(t.refresh?setTimeout(this.requestAnimationFrame.bind(this),t.refresh):requestAnimationFrame(this.update),this.ticking=!0)},requestAnimationFrame:function(){requestAnimationFrame(this.update.bind(this))},update:function(){this.render(),this.ticking=!1},doit:function(){this.requestTick()},render:function(){var e,i,s,n=this.settings,o=t.epoAPI.dom.size();e="fixed"===n.refresh?{top:0,left:0}:t.epoAPI.dom.scroll(),i=parseInt(e.top+(o.visibleHeight-t(n.floatboxID).height())/2,10),s=parseInt(e.left+(o.visibleWidth-t(n.floatboxID).width())/2,10),i=parseInt((i-this.top)/n.fps,10),s=parseInt((s-this.left)/n.fps,10),this.top+=i,this.left+=s,t(n.floatboxID).css({top:this.top+"px",left:this.left+"px",opacity:1})},show:function(){var e,i,s=this.settings;1===this.element.length&&(void 0===this.instance&&this.init(),s.hideelements&&t("embed, object, select").css({visibility:"hidden"}),i=t.epoAPI.dom.size(),!0===s.showoverlay&&(s._ovl?s._ovl.show():(s._ovl=t('<div class="fl-overlay"></div>').css({zIndex:parseInt(s.zIndex,10)-1,opacity:.8}),s._ovl.appendTo("body"),s.ismodal||(s.cancelEvent||s.unique?s._ovl.on("click",this.applyCancelEvent.bind(this)):s._ovl.on("click",s.cancelfunc.bind(this))))),s.showfunc&&s.showfunc.call(),t(s.floatboxID).removeClass("tc-closing").addClass(s.animationBaseClass+" "+s.animateIn),"fixed"===s.refresh?(!1!==s.top?e=s.top:(e=parseInt((i.visibleHeight-t(s.floatboxID).height())/2,10),e+="px"),t(s.floatboxID).css({position:"fixed",top:e}),!1!==s.left&&t(s.floatboxID).css({left:s.left})):this.render())},applyCancelEvent:function(){var t=this.settings;!0===t.cancelEvent?this.destroy():"function"==typeof t.cancelEvent&&t.cancelEvent.call(this,this)},applyUpdateEvent:function(){var t=this.settings;"function"==typeof t.updateEvent&&t.updateEvent.call(this,this)},init:function(){var e,i,s,n=this.settings;1===this.element.length&&(t.fn.tcFloatBox.instances.length>0&&(n.zIndex=parseInt(t.fn.tcFloatBox.instances[t.fn.tcFloatBox.instances.length-1].zIndex,10)+100),this.instance=t.fn.tcFloatBox.instances.length,t.fn.tcFloatBox.instances.push(n),n.id=n.id+this.instance,n.floatboxID="#"+t.epoAPI.dom.id(n.id),this.hide(),e=t.epoAPI.dom.size(),i=t.epoAPI.dom.scroll(),t(n.type).attr("id",n.id).addClass(n.classname).html(n.data).appendTo(this.element),t(n.floatboxID).css({width:n.width,height:n.height}),s=parseInt(i.left+(e.visibleWidth-t(n.floatboxID).width())/2,10),t(n.floatboxID).css({top:"0px",left:s+"px","z-index":n.zIndex}),this.top=0,this.left=s,this.cancelfunc=n.cancelfunc,n.cancelEvent&&n.cancelClass&&t(n.floatboxID).find(n.cancelClass).on("click",this.applyCancelEvent.bind(this)),n.updateEvent&&n.updateClass&&t(n.floatboxID).find(n.updateClass).on("click",this.applyUpdateEvent.bind(this)),this.show(),"fixed"!==n.refresh&&t(window).on("scroll.tcfloatbox"+this.instance,this.doit.bind(this)),t(window).on("resize.tcfloatbox"+this.instance,this.doit.bind(this)))}},t.fn.tcFloatBox=function(i){var s,n,o=t(this),a=o.data("tcfloatbox");return n="object"==typeof i?i:{},a||(a=new e(this,n),o.data("tcfloatbox",a)),"string"==typeof i&&(s=a[i].apply(a,[])),void 0===s?o:s},t.fn.tcFloatBox.defaults={id:"flasho",classname:"flasho",type:"div",data:"",width:"500px",height:"auto",closefadeouttime:1e3,animationBaseClass:"tm-animated",animateIn:"fadeIn",animateOut:"fadeOut",top:!1,left:!1,refresh:!1,fps:4,hideelements:!1,showoverlay:!0,zIndex:100100,ismodal:!1,cancelfunc:e.prototype.hide,showfunc:null,cancelEvent:!0,cancelClass:".floatbox-cancel",updateEvent:!1,updateClass:!1,unique:!0},t.fn.tcFloatBox.instances=[],t.fn.tcFloatBox.Constructor=e,t.tcFloatBox=function(i){var s=t("body"),n=!1;return s.map(function(){return t(this).data("tcfloatbox")||""}).get().some(function(t){return""===t})||i.unique?(n=new e(s,i),s.data("tcfloatbox",n)):(n=s.data("tcfloatbox")).init(),n}}(window.jQuery);